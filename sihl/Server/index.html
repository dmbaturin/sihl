<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Server (sihl.Server)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">sihl</a> &#x00BB; Server</nav><h1>Module <code>Server</code></h1><p>The web server service contains a HTTP server implementation.</p><nav class="toc"><ul><li><a href="#service-installation">Service Installation</a></li><li><a href="#usage">Usage</a></li></ul></nav></header><section><header><h2 id="service-installation"><a href="#service-installation" class="anchor"></a>Service Installation</h2><p>Use the provided <span class="xref-unresolved" title="unresolved reference to &quot;Sihl.Web.Server.MakeOpium&quot;"><a href="../Sihl/Web/index.html#module-Server"><code>Sihl.Web.Server</code></a>.MakeOpium</span> to create a web server service that uses <a href="https://github.com/rgrinberg/opium/">https://github.com/rgrinberg/opium/</a>. You need to inject a <a href="../Log__/Log_service_sig/module-type-SERVICE/index.html"><code>Sihl.Log.Service.Sig.SERVICE</code></a> and a <a href="../Cmd__/Cmd_service_sig/module-type-SERVICE/index.html"><code>Sihl.Cmd.Service.Sig.SERVICE</code></a>. Use the default implementation provided by Sihl:</p><pre><code class="ml">module Log = Sihl.Log.Service.Make ()
module Cmd = Sihl.Cmd.Service.Make ()
module WebServer = Sihl.Web.Server.Service.Make (Cmd)</code></pre></header><div class="spec module" id="module-Service"><a href="#module-Service" class="anchor"></a><code><span class="keyword">module</span> Service = <a href="../Server__/index.html#module-Server_service">Server__.Server_service</a></code></div></section><section><header><h2 id="usage"><a href="#usage" class="anchor"></a>Usage</h2><pre><code class="ml">let hello_page =
  Sihl.Web.Route.get &quot;/hello/&quot; (fun _ -&gt;
      Sihl.Web.Res.(html |&gt; set_body &quot;Hello!&quot;) |&gt; Lwt.return)

let hello_api =
  Sihl.Web.Route.get &quot;/hello/&quot; (fun _ -&gt;
      Sihl.Web.Res.(json |&gt; set_body {|{&quot;msg&quot;:&quot;Hello!&quot;}|}) |&gt; Lwt.return)

let endpoints = [ (&quot;/page&quot;, [ hello_page ], []); (&quot;/api&quot;, [ hello_api ], []) ]

WebServer.register_endpoints endpoints;
let* () = WebServer.start_server ctx in
...</code></pre></header><dl><dt class="spec type" id="type-routes"><a href="#type-routes" class="anchor"></a><code><span class="keyword">type</span> routes</code><code> = <a href="../Server__/Server_core/index.html#type-routes">Server__.Server_core.routes</a></code></dt><dt class="spec type" id="type-middleware_stack"><a href="#type-middleware_stack" class="anchor"></a><code><span class="keyword">type</span> middleware_stack</code><code> = <a href="../Server__/Server_core/index.html#type-middleware_stack">Server__.Server_core.middleware_stack</a></code></dt><dt class="spec type" id="type-endpoint"><a href="#type-endpoint" class="anchor"></a><code><span class="keyword">type</span> endpoint</code><code> = <a href="../Server__/Server_core/index.html#type-endpoint">Server__.Server_core.endpoint</a></code></dt></dl></section></div></body></html>