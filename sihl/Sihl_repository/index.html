<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Sihl_repository (sihl.Sihl_repository)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">sihl</a> &#x00BB; Sihl_repository</nav><h1>Module <code>Sihl_repository</code></h1><p>The repository service deals with cleaning repositories. This is useful for integration tests.</p><nav class="toc"><ul><li><a href="#installation">Installation</a></li><li><a href="#usage">Usage</a></li></ul></nav></header><section><header><h2 id="installation"><a href="#installation" class="anchor"></a>Installation</h2><p>Use the provided <span class="xref-unresolved" title="unresolved reference to &quot;Sihl.Repository.Service.Make&quot;"><a href="../Sihl/Repository/index.html#module-Service"><code>Sihl.Repository.Service</code></a>.Make</span> to instantiate a repo service.</p><pre><code class="ml">module Repo = Sihl.Repository.Service.Make () </code></pre></header><div class="spec module" id="module-Service"><a href="#module-Service" class="anchor"></a><code><span class="keyword">module</span> <a href="Service/index.html">Service</a> : <a href="Sig/index.html#module-type-SERVICE">Sig.SERVICE</a></code></div></section><section><header><h2 id="usage"><a href="#usage" class="anchor"></a>Usage</h2><p>You typically want to use the repo service in your own repositories in order to register repository cleaners. This allows Sihl to reset the state of your system after integration tests.</p><p><code>{ let cleaner = ... in Repo.register_cleaer cleaner; }</code></p><p>In order to clean all repositories that have registered cleaners you can call <code>clean_all</code>:</p><p><code>{ open Lwt.Syntax let* () = Repo.clean_all ctx in .. }</code></p></header><dl><dt class="spec module" id="module-Meta"><a href="#module-Meta" class="anchor"></a><code><span class="keyword">module</span> Meta = <a href="../Sihl_repository__/Model/index.html#module-Meta">Sihl_repository__.Model.Meta</a></code></dt><dd><p>Repositories can return meta data containing information like total rows affected. This can be useful for pagination.</p></dd></dl><dl><dt class="spec module" id="module-Dynparam"><a href="#module-Dynparam" class="anchor"></a><code><span class="keyword">module</span> Dynparam = <a href="../Sihl_repository__/Model/index.html#module-Dynparam">Sihl_repository__.Model.Dynparam</a></code></dt><dd><p>This module can be used to assemble dynamic repository queries. This is typically used if you don't know the number of parameters at compile time because they are provided by the user, for instance as a filter or sort. <a href="http://paurkedal.github.io/ocaml-caqti/caqti/Caqti_request/index.html#how-to-dynamically-assemble-queries-and-parameters">http://paurkedal.github.io/ocaml-caqti/caqti/Caqti_request/index.html#how-to-dynamically-assemble-queries-and-parameters</a></p></dd></dl><div class="spec module" id="module-Sig"><a href="#module-Sig" class="anchor"></a><code><span class="keyword">module</span> <a href="Sig/index.html">Sig</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div></section></div></body></html>